
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="WIS2 in a box (wis2box) is a Free and Open Source (FOSS) Reference Implementation of a WMO WIS2 Node. The project provides a plug and play toolset to ingest, process, and publish weather/climate/water data using standards-based approaches in alignment with the WIS2 principles. wis2box also provides access to all data in the WIS2 network. wis2box is designed to have a low barrier to entry for data providers, providing enabling infrastructure and services for data discovery, access, and visualization.">
      
      
        <meta name="author" content="World Meteorological Organization">
      
      
        <link rel="canonical" href="https://training.wis2box.wis.wmo.int/fr/practical-sessions/automating-data-ingestion/">
      
      
        <link rel="prev" href="../adding-gts-headers-to-wis2-notifications/">
      
      
        <link rel="next" href="../bufr-command-line-tools/">
      
      
      <link rel="icon" href="https://public.wmo.int/sites/all/themes/wmo/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Automatisation de l'ingestion de données - WIS2 in a box training</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#automatisation-de-lingestion-de-donnees" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../" title="WIS2 in a box training" class="md-header__button md-logo" aria-label="WIS2 in a box training" data-md-component="logo">
      
  <img src="../../../assets/img/wmo-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WIS2 in a box training
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Automatisation de l'ingestion de données
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Sélectionner la langue">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="fr" class="md-select__link">
              Français
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../es/practical-sessions/automating-data-ingestion/" hreflang="es" class="md-select__link">
              Español
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../zh/practical-sessions/automating-data-ingestion/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../ru/practical-sessions/automating-data-ingestion/" hreflang="ru" class="md-select__link">
              Русский
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../ar/practical-sessions/automating-data-ingestion/" hreflang="ar" class="md-select__link">
              العربية
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="WIS2 in a box training" class="md-nav__button md-logo" aria-label="WIS2 in a box training" data-md-component="logo">
      
  <img src="../../../assets/img/wmo-logo.png" alt="logo">

    </a>
    WIS2 in a box training
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Accueil
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Aide-mémoire
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Aide-mémoire
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/wis2box/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WIS2 in a box cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Modèles csv2bufr
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Modèles csv2bufr
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csv2bufr-templates/aws-template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modèle AWS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csv2bufr-templates/daycli-template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modèle DAYCLI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sessions pratiques
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Sessions pratiques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connecting-to-wis2-over-mqtt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connexion à WIS2 via MQTT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accessing-your-student-vm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Accéder à votre VM étudiant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../initializing-wis2box/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Initialisation de wis2box
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuring-wis2box-datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration des jeux de données dans wis2box
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuring-station-metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration des métadonnées des stations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingesting-data-for-publication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingestion de données pour publication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-conversion-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outils de conversion de données
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../csv2bufr-templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modèles de mappage de CSV à BUFR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adding-gts-headers-to-wis2-notifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ajout d'en-têtes GTS aux notifications WIS2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets-with-access-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration d'un ensemble de données recommandé avec contrôle d'accès
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../downloading-data-from-wis2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Téléchargement et décodage des données depuis WIS2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../discovering-datasets-from-wis2-gdc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Découverte de jeux de données depuis le Catalogue de Découverte Global WIS2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Préparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-1-configurer-un-script-python-pour-ingerer-des-donnees-dans-minio" class="md-nav__link">
    <span class="md-ellipsis">
      Exercice 1 : configurer un script Python pour ingérer des données dans MinIO
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-2-ingerer-des-donnees-binaires" class="md-nav__link">
    <span class="md-ellipsis">
      Exercice 2 : Ingérer des données binaires
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-3-ingerer-des-donnees-synop-au-format-ascii" class="md-nav__link">
    <span class="md-ellipsis">
      Exercice 3 : Ingérer des données SYNOP au format ASCII
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-4-ingerer-des-donnees-dans-minio-en-utilisant-sftp" class="md-nav__link">
    <span class="md-ellipsis">
      Exercice 4 : Ingérer des données dans MinIO en utilisant SFTP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="automatisation-de-lingestion-de-donnees">Automatisation de l'ingestion de données</h1>
<div class="admonition abstract">
<p class="admonition-title">Résultats d'apprentissage</p>
<p>À la fin de cette session pratique, vous serez capable de :</p>
<ul>
<li>comprendre comment les plugins de données de votre ensemble de données déterminent le workflow d'ingestion des données</li>
<li>ingérer des données dans wis2box en utilisant un script avec le client Python MinIO</li>
<li>ingérer des données dans wis2box en accédant à MinIO via SFTP</li>
</ul>
</div>
<h2 id="introduction">Introduction</h2>
<p>Le conteneur <strong>wis2box-management</strong> écoute les événements du service de stockage MinIO pour déclencher l'ingestion de données en fonction des plugins de données configurés pour votre ensemble de données. Cela vous permet de télécharger des données dans le seau MinIO et de déclencher le workflow wis2box pour publier des données sur le courtier WIS2.</p>
<p>Les plugins de données définissent les modules Python qui sont chargés par le conteneur <strong>wis2box-management</strong> et déterminent comment les données sont transformées et publiées.</p>
<p>Dans l'exercice précédent, vous deviez avoir créé un ensemble de données en utilisant le modèle <code>surface-based-observations/synop</code> qui incluait les plugins de données suivants :</p>
<p><img alt="mappages de données" src="/../assets/img/wis2box-data-mappings.png" width="800"></p>
<p>Lorsqu'un fichier est téléchargé sur MinIO, wis2box associera le fichier à un ensemble de données lorsque le chemin du fichier contient l'identifiant de l'ensemble de données (<code>metadata_id</code>) et il déterminera les plugins de données à utiliser en fonction de l'extension du fichier et du modèle de fichier défini dans les mappages de l'ensemble de données.</p>
<p>Dans les sessions précédentes, nous avons déclenché le workflow d'ingestion de données en utilisant la fonctionnalité de ligne de commande de wis2box, qui télécharge les données sur le stockage MinIO dans le chemin correct.</p>
<p>Les mêmes étapes peuvent être effectuées de manière programmatique en utilisant n'importe quel logiciel client MinIO ou S3, vous permettant d'automatiser votre ingestion de données dans le cadre de vos workflows opérationnels.</p>
<p>Alternativement, vous pouvez également accéder à MinIO en utilisant le protocole SFTP pour télécharger des données et déclencher le workflow d'ingestion de données.</p>
<h2 id="preparation">Préparation</h2>
<p>Connectez-vous à votre VM étudiant en utilisant votre client SSH (PuTTY ou autre).</p>
<p>Assurez-vous que wis2box est opérationnel :</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/wis2box-1.0.0rc1/
python3<span class="w"> </span>wis2box-ctl.py<span class="w"> </span>start
python3<span class="w"> </span>wis2box-ctl.py<span class="w"> </span>status
</code></pre></div>
<p>Assurez-vous que MQTT Explorer est en cours d'exécution et connecté à votre instance. Si vous êtes toujours connecté depuis la session précédente, effacez tous les messages précédents que vous avez reçus de la file d'attente.
Cela peut être fait soit en se déconnectant et en se reconnectant, soit en cliquant sur l'icône de la poubelle pour le sujet donné.</p>
<p>Assurez-vous que vous avez un navigateur web ouvert avec le tableau de bord Grafana pour votre instance en allant à <code>http://&lt;votre-hôte&gt;:3000</code></p>
<p>Et assurez-vous d'avoir un deuxième onglet ouvert avec l'interface utilisateur MinIO à <code>http://&lt;votre-hôte&gt;:9001</code>. Souvenez-vous que vous devez vous connecter avec le <code>WIS2BOX_STORAGE_USER</code> et le <code>WIS2BOX_STORAGE_PASSWORD</code> définis dans votre fichier <code>wis2box.env</code>.</p>
<h2 id="exercice-1-configurer-un-script-python-pour-ingerer-des-donnees-dans-minio">Exercice 1 : configurer un script Python pour ingérer des données dans MinIO</h2>
<p>Dans cet exercice, nous utiliserons le client Python MinIO pour copier des données dans MinIO.</p>
<p>MinIO fournit un client Python qui peut être installé comme suit :</p>
<div class="highlight"><pre><span></span><code>pip3<span class="w"> </span>install<span class="w"> </span>minio
</code></pre></div>
<p>Sur votre VM étudiant, le paquet 'minio' pour Python sera déjà installé.</p>
<p>Allez dans le répertoire <code>exercise-materials/data-ingest-exercises</code> ; ce répertoire contient un script d'exemple <code>copy_file_to_incoming.py</code> qui utilise le client Python MinIO pour copier un fichier dans MinIO.</p>
<p>Essayez d'exécuter le script pour copier le fichier de données d'exemple <code>csv-aws-example.csv</code> dans le seau <code>wis2box-incoming</code> dans MinIO comme suit :</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/exercise-materials/data-ingest-exercises
python3<span class="w"> </span>copy_file_to_incoming.py<span class="w"> </span>csv-aws-example.csv
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vous obtiendrez une erreur car le script n'est pas configuré pour accéder au point de terminaison MinIO sur votre wis2box.</p>
</div>
<p>Le script doit connaître le point de terminaison correct pour accéder à MinIO sur votre wis2box. Si wis2box fonctionne sur votre hôte, le point de terminaison MinIO est disponible à <code>http://&lt;votre-hôte&gt;:9000</code>. Le script doit également être mis à jour avec votre mot de passe de stockage et le chemin dans le seau MinIO pour stocker les données.</p>
<div class="admonition question">
<p class="admonition-title">Mettez à jour le script et ingérez les données CSV</p>
<p>Éditez le script <code>copy_file_to_incoming.py</code> pour corriger les erreurs, en utilisant l'une des méthodes suivantes :
- Depuis la ligne de commande : utilisez l'éditeur de texte <code>nano</code> ou <code>vim</code> pour éditer le script
- En utilisant WinSCP : démarrez une nouvelle connexion en utilisant le protocole de fichier <code>SCP</code> et les mêmes identifiants que votre client SSH. Naviguez jusqu'au répertoire <code>exercise-materials/data-ingest-exercises</code> et éditez <code>copy_file_to_incoming.py</code> en utilisant l'éditeur de texte intégré</p>
<p>Assurez-vous que vous :</p>
<ul>
<li>définissez le point de terminaison MinIO correct pour votre hôte</li>
<li>fournissez le mot de passe de stockage correct pour votre instance MinIO</li>
<li>fournissez le chemin correct dans le seau MinIO pour stocker les données</li>
</ul>
<p>Réexécutez le script pour ingérer le fichier de données d'exemple <code>csv-aws-example.csv</code> dans MinIO :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>copy_file_to_incoming.py<span class="w"> </span>csv-aws-example.csv
</code></pre></div>
<p>Et assurez-vous que les erreurs sont résolues.</p>
</div>
<p>Vous pouvez vérifier que les données ont été correctement téléchargées en vérifiant l'interface utilisateur MinIO et en voyant si les données d'exemple sont disponibles dans le répertoire correct dans le seau <code>wis2box-incoming</code>.</p>
<p>Vous pouvez utiliser le tableau de bord Grafana pour vérifier l'état du workflow d'ingestion de données.</p>
<p>Enfin, vous pouvez utiliser MQTT Explorer pour vérifier si des notifications ont été publiées pour les données que vous avez ingérées. Vous devriez voir que les données CSV ont été transformées en format BUFR et qu'une notification de données WIS2 a été publiée avec une URL "canonique" pour permettre le téléchargement des données BUFR.</p>
<h2 id="exercice-2-ingerer-des-donnees-binaires">Exercice 2 : Ingérer des données binaires</h2>
<p>Ensuite, nous essayons d'ingérer des données binaires au format BUFR en utilisant le client Python MinIO.</p>
<p>wis2box peut ingérer des données binaires au format BUFR en utilisant le plugin <code>wis2box.data.bufr4.ObservationDataBUFR</code> inclus dans wis2box.</p>
<p>Ce plugin divisera le fichier BUFR en messages BUFR individuels et publiera chaque message au courtier MQTT. Si la station pour le message BUFR correspondant n'est pas définie dans les métadonnées de la station wis2box, le message ne sera pas publié.</p>
<p>Puisque vous avez utilisé le modèle <code>surface-based-observations/synop</code> lors de la session précédente, vos mappages de données incluent le plugin <code>FM-12 data converted to BUFR</code> pour les mappages de l'ensemble de données. Ce plugin charge le module <code>wis2box.data.synop2bufr.ObservationDataSYNOP2BUFR</code> pour ingérer les données.</p>
<div class="admonition question">
<p class="admonition-title">Ingérer des données binaires au format BUFR</p>
<p>Exécutez la commande suivante pour copier le fichier de données binaires <code>bufr-example.bin</code> dans le seau <code>wis2box-incoming</code> dans MinIO :</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>copy_file_to_incoming.py<span class="w"> </span>bufr-example.bin
</code></pre></div>
</div>
<p>Vérifiez le tableau de bord Grafana et MQTT Explorer pour voir si les données de test ont été correctement ingérées et publiées et si vous voyez des erreurs, essayez de les résoudre.</p>
<div class="admonition question">
<p class="admonition-title">Vérifiez l'ingestion des données</p>
<p>Combien de messages ont été publiés au courtier MQTT pour cet échantillon de données ?</p>
</div>
<details class="success">
<summary>Cliquez pour révéler la réponse</summary>
<p>Si vous avez correctement ingéré et publié le dernier échantillon de données, vous devriez avoir reçu 10 nouvelles notifications sur le courtier MQTT wis2box. Chaque notification correspond aux données d'une station pour un horodatage d'observation.</p>
<p>Le plugin <code>wis2box.data.bufr4.ObservationDataBUFR</code> divise le fichier BUFR en messages BUFR individuels et publie un message pour chaque station et horodatage d'observation.</p>
</details>
<h2 id="exercice-3-ingerer-des-donnees-synop-au-format-ascii">Exercice 3 : Ingérer des données SYNOP au format ASCII</h2>
<p>Lors de la session précédente, nous avons utilisé le formulaire SYNOP dans l'<strong>application web wis2box</strong> pour ingérer des données SYNOP au format ASCII. Vous pouvez également ingérer des données SYNOP au format ASCII en téléchargeant les données dans MinIO.</p>
<p>Lors de la session précédente, vous deviez avoir créé un ensemble de données qui incluait le plugin 'FM-12 data converted to BUFR' pour les mappages de l'ensemble de données :</p>
<p><img alt="mappages de l'ensemble de données" src="/../assets/img/wis2box-data-mappings.png" width="800"></p>
<p>Ce plugin charge le module <code>wis2box.data.synop2bufr.ObservationDataSYNOP2BUFR</code> pour ingérer les données.</p>
<p>Essayez d'utiliser le client Python MinIO pour ingérer les données de test <code>synop-202307.txt</code> et <code>synop-202308.txt</code> dans votre instance wis2box.</p>
<p>Notez que les 2 fichiers contiennent le même contenu, mais le nom du fichier est différent. Le nom du fichier est utilisé pour déterminer la date de l'échantillon de données.</p>
<p>Le plugin synop2bufr s'appuie sur un modèle de fichier pour extraire la date du nom du fichier. Le premier groupe dans l'expression régulière est utilisé pour extraire l'année et le deuxième groupe est utilisé pour extraire le mois.</p>
<div class="admonition question">
<p class="admonition-title">Ingérer des données FM-12 SYNOP au format ASCII</p>
<p>Retournez à l'interface MinIO dans votre navigateur et naviguez jusqu'au seau <code>wis2box-incoming</code> et dans le chemin où vous avez téléchargé les données de test lors de l'exercice précédent.</p>
<p>Téléchargez les nouveaux fichiers dans le chemin correct dans le seau <code>wis2box-incoming</code> dans MinIO pour déclencher le workflow d'ingestion des données.</p>
<p>Vérifiez le tableau de bord Grafana et MQTT Explorer pour voir si les données de test ont été correctement ingérées et publiées.</p>
<p>Quelle est la différence dans le <code>properties.datetime</code> entre les deux messages publiés au courtier MQTT ?</p>
</div>
<details class="success">
<summary>Cliquez pour révéler la réponse</summary>
<p>Vérifiez les propriétés des 2 dernières notifications dans MQTT Explorer et vous noterez que l'une des notifications a :</p>
<div class="highlight"><pre><span></span><code>&quot;properties&quot;: {
    &quot;data_id&quot;: &quot;wis2/urn:wmo:md:nl-knmi-test:surface-based-observations.synop/WIGOS_0-20000-0-60355_20230703T090000&quot;,
    &quot;datetime&quot;: &quot;2023-07-03T09:00:00Z&quot;,
    ...
</code></pre></div>
<p>et l'autre notification a :</p>
<div class="highlight"><pre><span></span><code>&quot;properties&quot;: {
    &quot;data_id&quot;: &quot;wis2/urn:wmo:md:nl-knmi-test:surface-based-observations.synop/WIGOS_0-20000-0-60355_20230803T09:00:00Z&quot;,
    ...
</code></pre></div>
<p>Le nom du fichier a été utilisé pour déterminer l'année et le mois de l'échantillon de données.</p>
</details>
<h2 id="exercice-4-ingerer-des-donnees-dans-minio-en-utilisant-sftp">Exercice 4 : Ingérer des données dans MinIO en utilisant SFTP</h2>
<p>Les données peuvent également être ingérées dans MinIO via SFTP.</p>
<p>Le service MinIO activé dans la pile wis2box a SFTP activé sur le port 8022. Vous pouvez accéder à MinIO via SFTP en utilisant les mêmes identifiants que pour l'interface utilisateur MinIO. Dans cet exercice, nous utiliserons les identifiants administrateur pour le service MinIO tels que définis dans <code>wis2box.env</code>, mais vous pouvez également créer des utilisateurs supplémentaires dans l'interface utilisateur MinIO.</p>
<p>Pour accéder à MinIO via SFTP, vous pouvez utiliser n'importe quel logiciel client SFTP. Dans cet exercice, nous utiliserons WinSCP, qui est un client SFTP gratuit pour Windows.</p>
<p>En utilisant WinSCP, votre connexion ressemblerait à ceci :</p>
<p><img alt="connexion sftp-winscp" src="/../assets/img/winscp-sftp-connection.png" width="400"></p>
<p>Pour le nom d'utilisateur et le mot de passe, utilisez les valeurs des variables d'environnement <code>WIS2BOX_STORAGE_USERNAME</code> et <code>WIS2BOX_STORAGE_PASSWORD</code> de votre fichier <code>wis2box.env</code>. Cliquez sur 'enregistrer' pour sauvegarder la session puis sur 'connexion' pour vous connecter.</p>
<p>Lorsque vous vous connectez, vous verrez le seau MinIO <code>wis2box-incoming</code> et <code>wis2box-public</code> dans le répertoire racine. Vous pouvez télécharger des données dans le seau <code>wis2box-incoming</code> pour déclencher le workflow d'ingestion des données.</p>
<p>Cliquez sur le seau <code>wis2box-incoming</code> pour naviguer dans ce seau, puis faites un clic droit et sélectionnez <em>Nouveau</em>-&gt;<em>Répertoire</em> pour créer un nouveau répertoire dans le seau <code>wis2box-incoming</code>.</p>
<p>Créez le répertoire <em>not-a-valid-path</em> et téléchargez le fichier <em>randomfile.txt</em> dans ce répertoire (vous pouvez utiliser n'importe quel fichier que vous aimez).</p>
<p>Vérifiez ensuite le tableau de bord Grafana au port 3000 pour voir si le workflow d'ingestion des données a été déclenché. Vous devriez voir :</p>
<p><em>ERREUR - Erreur de validation du chemin : Impossible de faire correspondre http://minio:9000/wis2box-incoming/not-a-valid-path/randomfile.txt à l'ensemble de données, le chemin doit inclure l'un des éléments suivants : ...</em></p>
<p>L'erreur indique que le fichier a été téléchargé sur MinIO et que le workflow d'ingestion des données a été déclenché, mais comme le chemin ne correspond à aucun ensemble de données dans l'instance wis2box, le mappage des données a échoué.</p>
<p>Vous pouvez également utiliser <code>sftp</code> depuis la ligne de commande :</p>
<p><div class="highlight"><pre><span></span><code>sftp<span class="w"> </span>-P<span class="w"> </span><span class="m">8022</span><span class="w"> </span>-oBatchMode<span class="o">=</span>no<span class="w"> </span>-o<span class="w"> </span><span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no<span class="w"> </span>&lt;mon-nom-d<span class="err">&#39;</span>hôte-ou-ip&gt;
</code></pre></div>
Connectez-vous en utilisant les identifiants définis dans <code>wis2box.env</code> pour les variables d'environnement <code>WIS2BOX_STORAGE_USERNAME</code> et <code>WIS2BOX_STORAGE_PASSWORD</code>, naviguez jusqu'au seau <code>wis2box-incoming</code> puis créez un répertoire et téléchargez un fichier comme suit :</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>wis2box-incoming
mkdir<span class="w"> </span>not-a-valid-path
<span class="nb">cd</span><span class="w"> </span>not-a-valid-path
put<span class="w"> </span>~/exercise-materials/data-ingest-exercises/synop.txt<span class="w"> </span>.
</code></pre></div>
<p>Cela entraînera une "erreur de validation du chemin" dans le tableau de bord Grafana indiquant que le fichier a été téléchargé sur MinIO.</p>
<p>Pour quitter le client sftp, tapez <code>exit</code>.</p>
<div class="admonition question">
<p class="admonition-title">Ingérer des données dans MinIO en utilisant SFTP</p>
<p>Essayez d'ingérer le fichier <code>synop.txt</code> dans votre instance wis2box en utilisant SFTP pour déclencher le workflow d'ingestion des données.</p>
<p>Vérifiez l'interface utilisateur MinIO pour voir si le fichier a été téléchargé dans le chemin correct dans le seau <code>wis2box-incoming</code>.</p>
<p>Vérifiez le tableau de bord Grafana pour voir si le workflow d'ingestion des données a été déclenché ou s'il y avait des erreurs.</p>
</div>
<p>Pour vous assurer que vos données sont correctement ingérées, assurez-vous que le fichier est téléchargé dans le seau <code>wis2box-incoming</code> dans un répertoire qui correspond à l'identifiant de l'ensemble de données ou au sujet de votre ensemble de données.</p>
<h2 id="conclusion">Conclusion</h2>
<div class="admonition success">
<p class="admonition-title">Félicitations !</p>
<p>Dans cette session pratique, vous avez appris à :</p>
<ul>
<li>déclencher le workflow wis2box en utilisant un script Python et le client Python MinIO</li>
<li>utiliser différents plugins de données pour ingérer différents formats de données</li>
<li>télécharger des données sur MinIO en utilisant SFTP</li>
</ul>
</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 World Meteorological Organization
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../../assets/js/disclaimer.js"></script>
      
    
  </body>
</html>